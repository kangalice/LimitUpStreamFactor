# MarketDataManager 成员字段说明

以下整理 `MarketDataManager` 中供 `limit_up` 实盘因子使用的字段，逐一标注其 **C++ 类型**、**数据来源/更新时间点** 以及主要用途，便于快速查阅。

## 参数与静态基准

- `EventDrivenParams *params`  
  - **来源**：构造函数入参直接注入。  
  - **说明**：承载所有运行参数，如 `tickTimeLag`、形态分组列表、前收等，因子需要读取配置时通过该指针访问。  

- `double pre_close`  
  - **来源**：`params->preClose`；构造时赋值。  
  - **说明**：昨收价，所有涨跌幅、阈值及收益率计算的基准。  

- `double free_float_capital`  
  - **来源**：`params->freeFloatCapital`；构造时赋值。  
  - **说明**：自由流通股本（万股），用于成交占比、量能归一化。  

- `bool zcz`  
  - **来源**：构造函数根据股票代码是否为创业板/科创板（首字母 3/68）设置。  
  - **说明**：注册制标记，决定涨跌幅阈值、收益折半等规则。  

- `bool starts_with3` / `bool starts_with68`  
  - **来源**：构造函数依据股票代码前缀写入。  
  - **说明**：更细的板块标记，便于在因子内区分创业板（3）与科创板（68）。  

- `double high_limit_close`  
  - **来源**：构造函数按 `pre_close*(1±maxPriceLimitRatio)` 计算并四舍五入。  
  - **说明**：日内涨停价，用于阈值、盘口比较。  

- `double high_price`  
  - **来源**：`ProcessRealTimeTrade` 遍历成交时持续更新。  
  - **说明**：当日最高成交价。  

- `double open_price`  
  - **来源**：首个有效 Tick（或首笔成交）在 `AddQuoteHelp` / `ProcessRealTimeTrade` 中写入。  
  - **说明**：当日开盘价，差异化收益或状态判断使用。  

- `double jhjj_price`  
  - **来源**：集合竞价成交 (`AddToJhjjMap`) 时更新。  
  - **说明**：集合竞价阶段的最新成交价，部分因子需要与连续竞价数据对比。  

- `uint64_t ZT_local_time` / `uint64_t reached_ZT_time`  
  - **来源**：`ProcessRealTimeTrade` 中根据成交记录涨停触发时间；`SetReachedZTTime` 可覆盖原始时间戳。  
  - **说明**：涨停触发时刻（本地/原始），用于截断窗口、定位涨停前后阶段。  

- `uint64_t total_qty`  
  - **来源**：`ProcessRealTimeTrade` 累计成交时更新。  
  - **说明**：当日累计成交量，部分相对强度指标做归一化时使用。  



## 逐笔成交与滚动窗口

- `std::vector<Fill *> fill_list`  
  - **来源**：`AddToAllMap` 在每笔成交时 `push_back`。  
  - **说明**：全量逐笔成交序列，提供历史遍历。  

- `std::vector<Fill *> lxjj_fill_list`  
  - **来源**：`AddToLxjjMap` 在连续竞价成交时追加。  
  - **说明**：只包含连续竞价部分，排除集合竞价波动。  

- `std::vector<Fill *> last_5sec_fill_list` / `std::vector<Fill *> last_1min_fill_list`  
  - **来源**：`PrepareLastNMinFillData` 维护 5 秒、1 分钟滚动窗口。  
  - **说明**：短期成交统计、波动类因子的输入。  

- `std::vector<Trade *> last_1min_trade_list`  
  - **来源**：`PrepareLast1MinTrade` 将成交/撤单转换后维护 60 秒窗口。  
  - **说明**：成交节奏、撤单影响评估。  

- `std::unordered_map<uint64_t, MarketOrder> last_1min_trade_buy_map` / `last_1min_trade_sell_map`  
  - **来源**：`PrepareLast1MinFill` 在每笔成交时聚合，窗口外数据由 `PrepareLast1MinTrade` 剔除。  
  - **说明**：按买/卖编号聚合的近 1 分钟成交，用于主动性、均量统计。  

- `Fill *last_fill`  
  - **来源**：`ProcessRealTimeTrade` 在生成新 `Fill` 后更新。  
  - **说明**：最近一笔成交对象，便于取最新价格、收益等。  

## 连续竞价结构

- `std::unordered_map<uint64_t, MarketOrder> lxjj_trade_buy_map` / `lxjj_trade_sell_map`  
  - **来源**：`AddToLxjjMap` 按买/卖编号记录连续竞价成交。  
  - **说明**：累计编号维度的成交信息，供编号差值、集中度等指标使用。  

- `std::set<uint64_t> lxjj_buy_no_set` / `lxjj_sell_no_set`  
  - **来源**：`AddToLxjjMap` 首次看到编号时插入。  
  - **说明**：连续竞价阶段买/卖编号去重集合。  

- `std::map<uint64_t, double> lxjj_time_to_price`  
  - **来源**：`AddToLxjjMap` 在相应时间戳插入/覆盖成交价。  
  - **说明**：时间戳→价格映射，用于线性路径、分段收益比较。  

- `std::vector<TimeInfo> lxjj_time_info_list`  
  - **来源**：`AddToLxjjMap` 聚合同一毫秒内成交，否则追加新 `TimeInfo`。  
  - **说明**：提供成交量、金额、方向及与上一笔时间差的序列，支撑滚动回归/相关分析。  

- `double lxjj_total_amt` / `uint64_t lxjj_total_qty`  
  - **来源**：`ProcessRealTimeTrade` 在连续竞价阶段累加。  
  - **说明**：连续竞价累计成交额/量，用于强度、占比指标。  

- `std::vector<TOrder *> lxjj_order_list`  
  - **来源**：`ProcessRealTimeOrder` 在 9:30 后追加。  
  - **说明**：连续竞价委托流，配合成交窗口衡量盘口变化。  

## 行情与触发信息

- `std::vector<Tick *> quote_list`  
  - **来源**：`AddQuoteHelp` 自 09:15 起去重追加最新 Tick。  
  - **说明**：提供十档盘口、总量等行情快照，因子按需截取窗口。  

## Fill 结构补充

生成 `Fill` 时会基于当前 `Trade` 及上一笔 `Fill` 递推所有字段，主要成员如下：

- `double price` / `uint64_t qty` / `double amt`：成交价格、数量及金额（金额保留 2 位）。  
- `uint64_t buy_no` / `uint64_t sell_no`：成交买、卖编号。  
- `uint64_t timestamp` / `uint64_t trade_index`：成交时间戳（毫秒）与成交序号。  
- `double ret` / `double lxjj_ret`：相对上一笔价格的收益率；集合竞价阶段置为 `NaN`，连续竞价时才有效。  
- `int side` / `bool is_in_jhjj_period`：成交方向（连续竞价值 1=买、2=卖）及是否处于集合竞价。  
- `int64_t buy_diff` / `int64_t sell_diff`：连续竞价阶段同编号连续成交的标记。  
- `double bs_diff`：当前方向与上一笔方向的差值绝对值，用于识别方向切换。  
- `uint64_t trade_qty1` / `trade_qty2`、`double trade_money1` / `trade_money2`：按方向拆分的成交量、成交额。  
- `uint64_t cum_trade_qty` / `cum_trade_qty1` / `cum_trade_qty2`：自连续竞价开始累计的总量及买/卖拆分量。  
- `double cum_trade_money` / `cum_trade_money1` / `cum_trade_money2`：对应的累计成交额。

这些字段是因子读取逐笔成交信息的基本单位，与上文的 `fill_list`、`last_fill` 等结构配合使用。

