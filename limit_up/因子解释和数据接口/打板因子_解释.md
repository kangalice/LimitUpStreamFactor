| 字段名称 | 因子说明 | 频率分类 | 计算公式 | source依赖 | 所属逻辑 |
| :------------------------------ | :----------------------- | :--- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------- | :---------- |
| xly_t_prup_qty_ratio | 涨停价及以上成交量占比 | 逐笔 | 初始化时根据是否注册制确定涨停阈值(pre_close×1.12或1.06)并四舍五入，逐笔成交累加总量sum；若成交价≥阈值同步累加high_sum；最终输出high_sum/sum，若无成交则为0。 | pre_close, zcz, fill.price, fill.qty | 涨停强度/价量结构 |
| xly_t_prupt_uni_ratio | 涨停触发价位上独立价档占比 | 逐笔 | 依注册制标记确定涨停价并四舍五入；逐笔记录所有成交价的去重集合，同时跟踪首次触达涨停价时同一时间戳内的所有成交价，并将之后所有≥涨停价的成交价纳入高价集合；最终输出高价集合大小/全部成交价集合大小，集合为空时返回0。 | pre_close, zcz, fill.price, fill.timestamp, MathUtil::RoundHalfUp | 涨停强度/价量结构 |
| sss_turnsum_b10_p7 | 突破阈值后的买单“冲击量”近10段合计/流通股本 | 逐笔 | 阈值价=round(pre_close×(1.07+0.07×zcz)，2位小数)，首次突破后开始跟踪；对连续同编号买单累计成交量并维护最近10段，计算段量之和×100/自由流通市值。 | pre_close, zcz, fill.price, fill.qty, fill.buy_no, fill.sell_no, free_float_capital | 突破动能/资金冲击 |
| zwh_20230831_005 | 成交额与(买挂量+成交量)之比相对昨收的偏离 | 逐笔 | 取最新一条tick的total_amount、total_volume、bid_order_qty，计算res=total_amount/(bid_order_qty+total_volume)，再算res/pre_close-1，新股再除以2。 | tick.total_amount, tick.total_volume, tick.bid_order_qty, pre_close, zcz | 量能性价比/买盘活跃 |
| sss_to_pricediffstd_all_s60 | 近60秒委托价相对成交价的加权标准差 | 逐笔 | 汇总近60秒未成交委托相对最近成交价格的价差(%，注册制除2)，按委托量计算VWAP并求加权方差后开方，输出作为标准差。 | lxjj_order_list(order_price, order_qty, time), fill_list(trade_price, amt, qty, time), pre_close, zcz | 盘口波动/执行不确定性 |
| yzhan_hf_f2_53 | 上涨成交量波动 - 全体成交量波动 | 逐笔 | 维护全部成交量和涨价成交量的log(qty)序列，分别以滑动50笔更新标准差；输出涨价序列标准差减去总体标准差。 | fill.qty, fill.ret | 交易结构/趋势跟随 |
| Vwap | 当日VWAP相对昨收的偏离（%） | 逐笔 | 计算当日所有成交总额/总量得到VWAP，与昨收比较求百分比；若为注册制新股则乘0.53。 | lxjj_total_amt, lxjj_total_qty, pre_close, zcz | 价量均衡/资金面 |
| sss_after_pbtimemax_7 | 首次上穿阈值后回落至阈值下方的最长停留时长 | 逐笔 | 阈值=round(pre_close×(1+0.01×7×(1+zcz)))；首次上穿后跟踪价格在阈值下方的时间段，记录最大持续时长输出，单位毫秒。 | pre_close, zcz, fill.price, fill.timestamp | 涨停博弈/回撤弹性 |
| yzhan_hf_f1_27 | 卖出成交额的50笔滚动波动 | 逐笔 | 仅对卖出成交(side==2)累加log(amt)，维护50笔窗口计算标准差，数据不足返回0。 | fill.amt, fill.side | 抛压强度/资金波动 |
| sundc_t_tran_16_fix | 主动买卖平均量差/总量 | 逐笔 | 对主动买/卖分别累计成交量与订单数，计算平均量差(activeBuyVol/(buyCount+1) - activeSellVol/(sellCount+1))并除以总成交量，异常值置0。 | fill.qty, fill.buy_no, fill.sell_no, lxjj_total_qty | 资金偏向/主动性 |
| A_P_opponents_ratio_sum_fix0 | 主动/被动小单占比之和 | 逐笔 | 逐笔成交区分买卖方向；若成交额≤5万计入“小单”分子并同时累加分母总量，最终输出(active小单占比 + 被动小单占比)，无成交时回填1.15。 | fill.side, fill.amt, fill.qty | 资金偏向/主动性 |
| BA_emotion_diff_sqrt | 买盘在涨停半程上下的强弱差 | 逐笔 | halfPrice=(high_limit_close - jhjj_price)/2 + jhjj_price；仅统计买单，高于阈值累加aboveSum，否则累加belowSum；输出((aboveSum-belowSum)/free_float_capital)的平方根并保留符号。 | high_limit_close, jhjj_price, free_float_capital, fill.side, fill.price, fill.qty | 资金偏向/主动性 |
| Boosting_average_zb_ratio_before_last_20 | 剔除最新20个大幅波动买单后的平均占比 | 逐笔 | 若买单编号在集合竞价阶段max_price-min_price≥0.01则纳入集合并累计其整单成交量；样本≥50时剔除最新20个编号，剩余编号的累计量均值除以自由流通股本后输出。 | fill.buy_no, fill.qty, lxjj_trade_buy_map(max_price,min_price,qty), lxjj_buy_no_set, free_float_capital | 突破动能/资金冲击 |
| Decaying_strength | 时间加权涨幅强度 | 逐笔 | 每笔计算距9:30的毫秒差delta与收益率ret=(price/pre_close-1)/(zcz?2:1)，累加sum1+=delta×ret×qty；收盘时用sum1/delta/lxjj_total_qty，若为NaN则置0.3。 | fill.timestamp, fill.price, fill.qty, pre_close, zcz, lxjj_total_qty | 趋势跟随/时间衰减 |
| EF_profit_coss_ratio_real_3 | 形态分组收益交叉比 | 逐笔 | 从参数读取shape4/shape2股票列表，合并其近两日open-to-pre-high比值与计数，计算-factor=shape4_sum×shape2_cnt/(shape4_cnt×shape2_sum)，若出现NaN则跳过。 | params.filterShape4StockList, params.shape4Last2DaysSum, params.shape4Last3DaysCount, GetOpenToPreHighRatio, params.filterShape2StockList, params.shape2Last2DaysSum, params.shape2Last3DaysCount | 情绪联动/外部映射 |
| FQS_2_ZT_compared_volume | 首次触及涨停后的成交量占比 | 逐笔 | 根据注册制与否设定阈值FQS_price=round(pre_close×1.07或1.14，2位)，当成交价首次≥阈值时记录时间并累计该时刻及之后的成交量，总量/自由流通股本为因子值。 | pre_close, zcz, fill.price, fill.qty, fill.timestamp, lxjj_fill_list, free_float_capital | 涨停强度/价量结构 |
| fc_ttickab_bs_qty_ratio | 涨停前盘口买卖挂量比中位数 | 盘口 | 在9:30到(ZT_time - tickTimeLag)区间倒序读取最多10条tick，计算(ask_order_qty+0.01)/(bid_order_qty+0.01)，返回中位数；若不足则为0。 | quote_list.ask_order_qty, quote_list.bid_order_qty, ZT_local_time, params.tickTimeLag | 盘口波动/执行不确定性 |
| fc_ttickab_lp_op_diff_max_turn | 涨停前盘口均价-最新价差最大值 | 盘口 | 搜集有效tick的ask_avg_px - last_px；若样本>50取最近50条的最大值/ pre_close，否则固定输出0.025。 | quote_list.ask_avg_px, quote_list.last_px, ZT_local_time, params.tickTimeLag, pre_close | 盘口波动/执行不确定性 |
| fc_ttickab_20231026_20 | 涨停前ask5溢价的均值/波动比 | 盘口 | 以ZT_time减tickTimeLag确定终点，倒序找到首条不晚于该时刻的tick并向前回溯最多600毫秒形成窗口；对窗口内tick按md_time/10000分组，计算ask5/pre_close-1（注册制股票再除以2）的组均值；最终取所有组均值的平均值除以(标准差+0.001)。 | quote_list.md_time, quote_list.ask_price[4], pre_close, starts_with3, starts_with68, ZT_local_time, params.tickTimeLag, TimeUtil::AddMilliseconds, TimeUtil::FunGetTime | 盘口波动/执行不确定性 |
| Sheep_or_goat | 主动卖单分档及买卖均单量比 | 逐笔 | 统计主动卖单次数：≤5返回0.5，≤25返回1.5，≤40返回2；超出时按(主动买单总量/买方编号数)/(主动卖单总量/卖方编号数)计算。 | fill.side, lxjj_buy_no_set, lxjj_sell_no_set | 资金偏向/主动性 |
| Short_buy_sell_mean_ratio | 涨停前5秒买卖平均单量对数比 | 逐笔 | 以ZT_time为基准回溯5秒，按买/卖编号在trade_map去重，统计首笔时间≥窗口起点的订单数量和笔数，求均量比后取ln，非法值置0。 | GetZTLocalTime, last_5sec_fill_list, lxjj_trade_buy_map, lxjj_trade_sell_map, MarketOrder.first_fill_time, MarketOrder.qty | 资金偏向/主动性 |
| skk_order_bs_ratio_mean | 近30个时间片卖单均量/买单均量比 | 逐笔 | 找到最近order_type=='2'委托时间，回溯30秒(不早于9:30)，累加区间内买/卖委托量与笔数，输出均买量/均卖量，结果截顶100，异常值置2.2。 | lxjj_order_list.order_type, lxjj_order_list.side, lxjj_order_list.order_qty, lxjj_order_list.md_time, TimeUtil::FunGetTime | 盘口结构/挂单质量 |
| sss_1s_volsbo_num_bsdiff | 高量秒级主动买卖次数差 | 逐笔 | 按秒聚合成交量与金额，标记buy_no>sell_no的量为主动买；以均值+标准差为阈值合并连续高量秒段，比较主动买比例>0.5与<0.5的段数，占比相减后输出。 | fill.timestamp, fill.qty, fill.amt, fill.buy_no, fill.sell_no, MathUtil | 突破动能/资金冲击 |
| sss_4wbigamt1_diff_open | 早盘大额买卖净额 | 逐笔 | 在时间93000000-100000000内累计每个买/卖编号成交额；若编号在早盘过滤集合中且累计金额>4万，则并入总买/卖额，最终输出totalBuySum-totalSellSum。 | fill.timestamp, fill.buy_no, fill.sell_no, fill.amt | 突破动能/资金冲击 |
| sss_after_pbtimemax_8 | 突破8%线后回踩停留时间最大值 | 逐笔 | 阈值=round(pre_close×(1+0.01×8×(1+zcz标记)))；首次上穿后记录后续跌破与再上穿的时间差，持续更新最大值并输出。 | pre_close, starts_with3, starts_with68, fill.price, fill.timestamp | 涨停博弈/回撤弹性 |
| sss_breaknum_diff | 多价成交买卖编号差 | 逐笔 | 对买单(buy_no>sell_no)与卖单分别记录首个成交价，若同编号后续出现不同价则加入集合，因子为买集合数减卖集合数。 | fill.buy_no, fill.sell_no, fill.price | 交易结构/趋势跟随 |
| sss_tk_slope_sell_t20_max | 最近20笔盘口卖盘倾斜度最大值 | 盘口 | 截断时间前倒序取最多20条tick，计算(1-ask_qty0/总卖量)/(最远非零卖价-最优价)，记录最大值；样本不足返回0。 | quote_list.ask_qty[0..9], quote_list.ask_price[0..9], quote_list.last_px, ZT_local_time, params.tickTimeLag | 盘口结构/挂单质量 |
| sss_tk_spctdiff_all_half | 卖均价偏离后半段vs总体 | 盘口 | 截取9:30至截断时刻的tick，计算每点(ask_avg_px-last_px)/pre_close(注册制再除以2)，求全部均值及后半段均值，输出ln(halfMean/mean)。 | quote_list.ask_avg_px, quote_list.last_px, pre_close, zcz, ZT_local_time, params.tickTimeLag | 盘口波动/执行不确定性 |
| stdBvol | 近1分钟买单量标准差 | 逐笔 | 若last_1min_trade_buy_map非空，对其中每个编号的qty求样本标准差，空集返回0。 | last_1min_trade_buy_map.qty | 成交节奏/短期波动 |
| Straight_diff_mean | 实际路径与线性拉升差额 | 逐笔 | 维护成交时间戳→成交价映射与总价和，假设价格从jhjj_price线性拉升到high_price，计算(jhjj_price×size - price_sum + cnt×ratio×size/2)/cnt，异常值置0.2。 | lxjj_time_to_price, jhjj_price, high_price, pre_close | 涨停强度/价量结构 |
| Straight_diff_mean_s | 线性差额相对涨幅比例 | 逐笔 | 与Straight_diff_mean相同，但结果再除以(zt_price - pre_close)，若无效则返回0.11。 | lxjj_time_to_price, jhjj_price, high_price, pre_close | 涨停强度/价量结构 |
| sundc_t_tran_6 / sundc_t_tran_12 / sundc_t_tran_13 | 最近触发窗口的买卖量&集中度特征 | 逐笔 | 取最近5个成交/撤单时间构成窗口；`sundc_t_tran_6` 为窗口内买卖金额之和除以(high_price×free_float_capital)；`sundc_t_tran_12` 用成交量中位数阈值区分大单，计算大买量与大卖量差占比；`sundc_t_tran_13` 为买侧成交次数标准差与卖侧成交次数标准差之比。 | fill_list(buy_no,sell_no,qty,amt), high_price, free_float_capital, MathUtil | 资金动向/大单集中度 |
| sundc_t_tran_14 | 窗口内委托编号成交次数偏度 | 逐笔 | 取最近5个成交/撤单时间点，统计窗口内各买/卖编号的成交次数并计算偏度，买卖两侧偏度之和为因子。 | fill_list(buy_no,sell_no,timestamp), MathUtil::calcSkew | 资金动向/活跃度 |
| sundc_t_tran_18 | 涨停/非涨停成交编号对比 | 逐笔 | 统计涨停价成交与非涨停价成交的买卖编号集合，输出 ` | ZT买 | /( |
| V_BLtNzR23 | 突破前1分钟买单成交时长非零占比 | 逐笔 | 统计 `last_1min_trade_buy_map` 中首尾成交时间不相同的买单数量，占所有买单数量的比例。 | last_1min_trade_buy_map(first_fill_time,last_fill_time) | 成交节奏/连续性 |
| V_BSVolRatio2 | 买卖累计量之比 | 逐笔 | 累加成交量并结合撤单量，分别形成买/卖侧总量；返回 `totalSellQty/totalBuyQty`，空集返回0。 | trade.trade_qty, cancel.order_qty, cancel.side | 资金偏向/主动性 |
| V_WAmtSLt23 | 突破前1分钟卖单成交时长加权均值 | 逐笔 | 对 `last_1min_trade_sell_map` 中的卖单，以成交金额为权重计算 `fill_time_delta` 的加权平均；无数据返回0。 | last_1min_trade_sell_map(fill_time_delta, amt) | 成交节奏/时间成本 |
| V_vtpcBact23_4 | 主动买成交VWAP相对昨收偏离 | 逐笔 | 在 `last_1min_trade_list` 中挑选对手编号买方大于卖方的成交，计算这些成交的VWAP与昨收之差（%），注册制标的再乘0.5。 | last_1min_trade_list(trade_price,trade_qty,trade_buy_no,trade_sell_no), pre_close, zcz | 涨停强度/价量结构 |
| Volume_pctchg_corr_linear / Relative_total_strength / Relative_total_strength_linear_0085 | 成交量-收益相关与相对强度 | 逐笔 | 使用 `lxjj_time_info_list` 构建成交量与收益序列：更新时递推线性回归，得到收益与成交量的相关性偏离、累计成交量×收益占比，以及与0.085阈值的偏离。outputs依次为相关性差值、相对强度、相对强度与0.085差值。 | lxjj_fill_list, lxjj_time_info_list(price,qty), pre_close, total_qty | 交易结构/趋势跟随 |
| wd_t_10_itvl_max | 涨停前10秒最大成交间隔 | 逐笔 | 集合所有成交时间，回溯涨停触发前10秒区间，输出该区间内相邻成交的最大间隔，若无合规间隔则给默认1200毫秒。 | fill.timestamp, GetZTLocalTime, TimeUtil | 成交节奏/停顿判断 |
| wd_t_big_pct_max | 前一档最低价到当前最高价的最大涨幅 | 逐笔 | 逐毫秒跟踪同一时间点的高低价，计算相邻时间段最高价相对前一个时间段最小价的最大涨幅；注册制按收益减半；若仍在同一段内则与最新价比较。 | fill.price, fill.timestamp, pre_close, zcz | 涨停博弈/价差延伸 |
| wj_TTick_20_bsv4 | 动态窗口买挂差距信噪比 | 盘口 | 根据涨停时间和延迟确定窗口，按秒级自适应长度收集 `(ask_order_qty - total_volume +1)/(total_volume+1)`，计算均值与标准差，输出 `(mean+1e-4)/(std+1e-4)`。 | quote_list(md_time,ask_order_qty,total_volume), params.tickTimeLag, GetZTLocalTime | 盘口结构/挂单质量 |
| wwd_t1_corrl_pv | 最近1分钟买单均价与数量相关 | 逐笔 | 聚合最近1分钟每个买编号的总金额/总量得到均价，再与对数数量做回归，返回皮尔逊相关系数。 | last_1min_fill_list(buy_no,amt,qty), SimpleRegression | 资金动向/大单行为 |
| xly_t_order_xa13 | 买单时间片上的卖单VWAP-数量相关性 | 逐笔 | 9:30后按`md_time/100000`聚合订单：卖单累加金额和数量，买单记录时间片；`Calculate`阶段从最近的30个买单时间片中，取同步存在卖单的片段构造卖单数量序列与对应VWAP，并计算二者的皮尔逊相关系数，缺样本返回0。 | TOrder.md_time, TOrder.side, TOrder.order_qty, TOrder.order_price, MathUtil::PearsonCorrelation | 盘口结构/挂单质量 |
| xbc_20230525_2 | 成交价与近邻买均价偏离对比 | 逐笔 | 以成交时间匹配同一3秒桶内的行情，累加 `(成交价 - tick.bid_avg_px)*成交量/(free_float_capital*pre_close)`，最多统计100次，少于5次输出0，最后取平均。 | lxjj_fill_list(price,qty,timestamp), quote_list(bid_avg_px,md_time), free_float_capital, pre_close | 盘口结构/价差覆盖 |
| yzhan_hf_ak2_40 | 高累计持仓相关性差值（量基准） | 逐笔 | 在最后成交序列中取cum_trade_qty1占比>0.98与>0.96部分，分别计算成交量占比与成交额占比的相关系数，输出两者差值。 | lxjj_fill_list(cum_trade_qty1, qty, amt), lxjj_total_qty, lxjj_total_amt | 成交结构/尾部形态 |
| yzhan_hf_ak4_40 | 高累计持仓相关性差值（金额基准） | 逐笔 | 与 `yzhan_hf_ak2_40` 类似，但使用 `cum_trade_money` 占比>0.98与>0.96 的成交，比较相关系数差值。 | lxjj_fill_list(cum_trade_money, qty, amt), lxjj_total_qty, lxjj_total_amt | 成交结构/尾部形态 |
| yzhan_hf_b2_38 | 涨价成交方向波动 | 逐笔 | 收集`ret>0`成交的买卖方向序列，滚动窗口保留最多32个，计算方向去均值后的标准差，序列不足10个时输出0。 | fill.ret, fill.side | 交易结构/方向稳定性 |
| yzhan_hf_c0_1 | 成交收益序列的标准化偏度 | 逐笔 | 累积非NaN收益，计算样本均值，并用三阶中心矩与二阶中心矩组合得到带样本修正的偏度；若收益完全相同则输出0。 | fill.ret | 交易结构/收益形态 |
| yzhan_hf_d6_46_fix | 长短期对比的对数成交量差 | 逐笔 | 对每笔成交取log(qty)，累计所有成交；若距当前≥128笔且过去价格更高，则同时累计子序列并记录数量，最终输出子序列均值与总体均值之差。 | fill.qty, fill_list历史价格 | 成交节奏/量能结构 |
| ZT_Time / sss_ZT_Time_ms / T_o2pre / sss_t_o2pre | 涨停触发时间与开盘偏离 | 逐笔 | 依次输出：涨停触发时刻的原始时间戳、距9:30的毫秒差、开盘价相对昨收收益、若为注册制则收益/2。 | reached_ZT_time, ZT_local_time, Lxjj_AM_Start, open_price, pre_close, zcz | 涨停节奏/相对位置 |
| zwh_20230824_004 | 价格区间内高低位成交额对比 | 逐笔 | 设两个阈值：高位为昨收×(1.08或1.16)，低位为昨收×(0.94或0.88)；累计对应价区间的成交额，计算 `(高位成交额 + 100×高位成交额标准差)/(0.1+总成交额)` 并四舍五入。 | fill.price, fill.amt, pre_close, zcz, MathUtil::calcStd | 涨停强度/价量结构 |
